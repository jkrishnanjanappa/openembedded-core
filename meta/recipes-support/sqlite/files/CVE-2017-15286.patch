SQLite 3.20.1 has a NULL pointer dereference in tableColumnList in shell.c 
because it fails to consider certain cases where 
`sqlite3_step(pStmt)==SQLITE_ROW` is false and a data structure 
is never initialized.

This CVE patch applies neatly on sqlite v3.20.0, hence applying
for sqlite v3.20.0.

Also, removed hunk of "src/shell.c.in" present in upstream 
commit https://www.sqlite.org/src/info/5d0ceb8dcdef92cd; as v3.20.0
does not have src/shell.c.in file.

CVE: CVE-2017-15286
Upstream-Status: Backport from v3.21

Signed-off-by: drh <name@hidden-address>
Signed-off-by: Jagadeesh Krishnanjanappa <jkrishnanjanappa@mvista.com>

Index: src/shell.c
==================================================================
--- src/shell.c
+++ src/shell.c
@@ -3799,10 +3799,11 @@
         isIPK = 0;
       }
     }
   }
   sqlite3_finalize(pStmt);
+  if( azCol==0 ) return 0;
   azCol[0] = 0;
   azCol[nCol+1] = 0;
 
   /* The decision of whether or not a rowid really needs to be preserved
   ** is tricky.  We never need to preserve a rowid for a WITHOUT ROWID table
