* g10/getkey.c (get_pubkey_byfprint): Filter by PK->REQ_USAGE.

CVE: CVE-2018-9234
Upstream-Status: Backport [https://dev.gnupg.org/rGa17d2d1f690ebe5d005b4589a5fe378b6487c657]

Signed-off-by: Jagadeesh Krishnanjanappa <jkrishnanjanappa@mvista.com>
diff -Naurp gnupg-2.2.0/g10/getkey.c gnupg-2.2.0/g10/getkey.c
--- gnupg-2.2.0_org/g10/getkey.c	2018-07-23 22:50:45.656745434 -0700
+++ gnupg-2.2.0/g10/getkey.c	2018-07-23 22:50:19.286965231 -0700
@@ -1801,6 +1801,8 @@ get_pubkey_byfprint (ctrl_t ctrl, PKT_pu
       ctx.items[0].mode = fprint_len == 16 ? KEYDB_SEARCH_MODE_FPR16
 	: KEYDB_SEARCH_MODE_FPR20;
       memcpy (ctx.items[0].u.fpr, fprint, fprint_len);
+      if (pk)
+        ctx.req_usage = pk->req_usage;
       rc = lookup (ctrl, &ctx, 0, &kb, &found_key);
       if (!rc && pk)
 	pk_from_block (pk, kb, found_key);
